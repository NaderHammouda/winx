stages:
    - build
    - sonarqube-check
    - deploy
build:
    stage: build
    tags: 
        - devops
    script:
        - echo "Building deploy package"
        - yarn install
        - yarn build
        - echo "Build successful"
    artifacts:
        expire_in: 1 hour
        paths:
            - build

sonarqube-check:
  stage: sonarqube-check
  image: 
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script: 
    - sonar-scanner
  allow_failure: true
  only:
    - merge_requests
    - master # or the name of your main branch
    - develop

deploy_production:
    stage: deploy
    tags: 
      - <tag you provided while registering the token>
      - <second tag>
    script:
        - echo "Deploying to server"
        - cp -rv build/* /var/www/html/<destination_folder>/
        - echo "Deployed"
    environment:
        name: production
        url: 13.90.96.96
    only:
        - master